### Data Dictionary for the Output of the Query

| Field Name             | Type      | Description |
|------------------------|-----------|-------------|
| **customer_id**        | STRING    | Unique identifier for the customer. It is a primary key used to join different tables in the data queries. |
| **grouped_category**   | STRING    | A reformulated category name based on the sub_category of the item purchased. This field is derived from a case statement that maps sub_categories like 'DAIRY', 'MEAT', etc., to more descriptive names such as 'DAIRY PRODUCTS', 'FRESH MEAT', etc. |
| **revenue_in_category**| DECIMAL   | The total revenue generated from sales within each grouped category for each customer over the specified fiscal year. This is calculated as the sum of gross sales. |
| **purchases_in_category** | INTEGER | The count of distinct purchase transactions (receipt numbers) within each grouped category for each customer over the specified fiscal year. |
| **total_revenue**      | DECIMAL   | (Joined from total_customer_revenue) The total revenue generated by each customer across all categories over the specified fiscal year. This value is the sum of gross sales for each customer. |
| **total_purchases**    | INTEGER   | (Joined from total_customer_purchases) The total number of distinct purchase transactions (receipt numbers) made by each customer over the specified fiscal year. |

### Data Dictionary for the Script

The script processes data from the "database_name"."sales_data_table" using SQL WITH clauses defined above and outputs the results to an AWS S3 bucket in Parquet format with Snappy compression. It specifically performs the following operations:

**1. total_customer_revenue:**
   - **Purpose:** Calculates the total revenue for each customer by summing up gross sales where the customer_id is not null, and transactions are within the fiscal year 2023-04-01 to 2024-03-31.

**2. total_customer_purchases:**
   - **Purpose:** Counts the number of distinct purchases (receipt numbers) made by each customer, ensuring transactions fall within the same fiscal year and customer_id is not null.

**3. revenue_purchases_by_category:**
   - **Purpose:** Groups sales data by reformulated categories to calculate total revenue and number of purchases within each category for each customer, using similar date and customer_id constraints.

The final SELECT operation:
   - Joins the results from these WITH clause tables to consolidate and report on the revenue and purchases by category alongside the total revenue and purchases for each customer. Output is then unloaded to an S3 bucket, formatted for efficiency and analytical processing.
